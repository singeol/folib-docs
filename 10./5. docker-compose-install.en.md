# Docker Compose Setup

## Create the file
Open **docker-compose.yaml** in your editor:

```sh
vim docker-compose.yaml
```

## Paste the content
Copy-paste the following `docker-compose.yaml`:

```yaml
version: "3.8"  # compose file format version
services:
  mysql:  # service name
    container_name: mysql
    image: docker.folib.com/folib-common/folib-docker/mysql5.7:latest
    environment:
      - MYSQL_ROOT_PASSWORD=folib@v587
      - lower_case_table_names=1
    volumes:
      - ~/folib/mysql/logs:/var/log/mysql
      - ~/folib/mysql/data:/var/lib/mysql
#      - ~/folib/etc/localtime:/etc/localtime:ro
    restart: always
    privileged: true
    ports:
      - "3306:3306"

  elasticsearch:
    container_name: elasticsearch
    image: docker.folib.com/folib-common/folib-docker/elasticsearch:7.3.1
    environment:
      - node.name=node-1
      - cluster.initial_master_nodes=node-1
      - discovery.seed_hosts=elasticsearch:9300
      - cluster.name=docker-elasticsearch-cluster
      - bootstrap.memory_lock=true
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    volumes:
      - ~/folib/es/conf:/usr/share/elasticsearch/conf
      - ~/folib/es/data:/usr/share/elasticsearch/data
      - ~/folib/es/plugins:/usr/share/elasticsearch/plugins
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    restart: always
    privileged: true
    ports:
      - "9200:9200" # HTTP
      - "9300:9300" # transport

  folib-mirror:
    container_name: folib-mirror
    image: docker.folib.com/folib-common/folib-docker/folib-mirror:1.0
    volumes:
      - ~/folib/mirror:/usr/local/apache2/htdocs
    restart: always
    privileged: true
    ports:
      - "8919:80"

  folib-server:
    container_name: folib-server
    image: docker.folib.com/folib-common/folib-docker/folib-server:1.0
    environment:
      - RUN_WORKDIR=/opt/folib
      - FOLIB_PORT=38080
      - FOLIB_JVM_XMX=512
      - FOLIB_DB_PROFILE=db_EMBEDDED
      - FOLIB_GREMLIN_SERVER_ENABLED=false
      - FOLIB_LOG_CONSOLE_ENABLED=false
      - FOLIB_LOG_FILE_ENABLED=true
      - FOLIB_LOG_FILE_SIZE_SINGLE=128MB
      - FOLIB_LOG_FILE_SIZE_TOTAL=1GB
      - FOLIB_LOG_FILE_HISTORY=31
      - FOLIB_DEBUG=false
      - FOLIB_NPM_REMOTE_CHANGES_ENABLED=false
      - FOLIB_NUGET_DOWNLOAD_FEED=false
      - FOLIB_DOWNLOAD_INDEXES=false
      - FOLIB_ES_HOST=elasticsearch:9200
      - FOLIB_MYSQL_HOST=mysql
      - FOLIB_MYSQL_PORT=3306
      - FOLIB_MYSQL_DB=folib_scanner
      - FOLIB_MYSQL_USER=root
      - FOLIB_MYSQL_PASSWORD=folib@v587
      - FOLIB_NVD=folib-mirror
      - FOLIB_JMX_PORT=7199
      - FOLIB_DISTRIBUTED_LOCKIP=127.0.0.1
      - FOLIB_CLUSTER_OPENFLAG=false
      - FOLIB_CLUSTER_HOSTNODE=http://127.0.0.1:38080
      - FOLIB_REMOTE_DB_HOST=127.0.0.1
      - FOLIB_REMOTE_DB_PORT=49142
      - FOLIB_REMOTE_DB_USER=root
      - FOLIB_REMOTE_DB_PASS=folib-cassandra
      - FOLIB_S3_REGION=folib
      - FOLIB_S3_URI=s3://localhost:9000/
      - FOLIB_S3_ACCESS_KEY=folib
      - FOLIB_S3_SECRET_KEY=folib
    volumes:
      - ~/folib/folib-conf:/opt/folib/folib-1.0-SNAPSHOT/etc/conf
      - ~/folib/folib-vault:/opt/folib/folib-vault
    restart: always
    privileged: true
    ports:
      - "38080:38080"
      - "7010:7010"
      - "7011:7011"
      - "7199:7199"
      - "49142:49142"
      - "8182:8182"
    links:
      - mysql:mysql
      - elasticsearch:elasticsearch
      - folib-mirror:folib-mirror
    depends_on:
      - mysql
      - elasticsearch
      - folib-mirror
```

> ⚠️ Note: You can review and adjust environment variables using the **Environment variables table** referenced in the configuration docs.

## Start it up
From the folder containing `docker-compose.yaml`, run:

```sh
docker-compose up -d
```

> ⚠️ Make sure **docker** and **docker-compose** are installed on the host before running.
